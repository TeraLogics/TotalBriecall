<% include ./common/header.ejs %>
<% include ./common/brie-core-js.ejs %>



<% if (recall) { %>
<meta property="og:site_name" content="Total Briecall"/>
<meta property="og:locale" content="en_US"/>
<meta property="fb:app_id" content="<%= brie.fbappid %>"/>
<meta property="og:url" content="<%= url + '/details/' + recall.id %>"/>
<meta property="og:title" content="<%= recall.product_description %>"/>
<meta property="og:description" content="<%= recall.reason_for_recall %>"/>
<meta property="og:type" content="article"/>
<meta property="og:image" content="http://graphics.myfavnews.com/images/logo-100x100.jpg"/>
<meta property="article:author" content="<%= url %>"/>
<meta property="article:publisher" content="https://open.fda.gov"/>
<style>
	.steps {
		list-style: none;
		counter-reset: li;
		padding-left: 0;
	}
	.steps>li {
		counter-increment: step <%= recall.classificationlevel %>;
		position: relative;
		clear: both;
		padding-left: 110px;
		min-height: 100px;
	}
	.steps>li:before {
		content: counter(step, upper-roman);
		font-size: 40px;
		background: rgba(0, 0, 0, 0.3);
		color: white;
		position: absolute;
		top: 0;
		left: 0;
		width: 100px;
		height: 100px;
		line-height: 100px;
		text-align: center;
	}
	.steps.c1>li:before {
		background: rgba(255, 0, 0, 0.7);
	}
	.steps.c2>li:before {
		background: rgba(255, 128, 0, 0.7);
	}
	.steps.c3>li:before {
		background: rgba(255, 255, 0, 0.7);
	}
	.details {
		list-style: none;
		counter-reset: li;
		padding-left: 0;
	}
	.recall-details-panel {
		padding-left: 15px;
	}
</style>
</head>
<body class="bg-void application">
<div class="navmenu navmenu-default">
	<!-- off-canvas menu goes here -->
</div>
<div class="container-flexible">
	<div class="panel panel-default panel-expanded">
		<div class="map-container hidden-xs visible-sm visible-md visible-lg">
			<div id="map"></div>
		</div>
		<ol id="recall-categories">
			<% _.each(recall.categories, function (category) { %>
			<!--<img height="100px" class="recall-category-card" src="/img/foodcategories/<%= category %>.jpg"/>-->
			<% }); %>
		</ol>
		<div class="recall-details-panel">
			<ol class="steps c<%= (recall.classificationlevel > 3) ? '' : recall.classificationlevel %>">
				<li>
					<h3 class="panel-title"><%= recall.product_description %></h3>
					<h4 class="panel-subtitle">
						<a data-toggle="tooltip" data-placement="bottom" title="<%= recall.city + ', ' + recall.state + ', ' + recall.country; %>" href="">
							<%= recall.recalling_firm %>
						</a> &nbsp;-&nbsp;
						<small>
							<%= moment.unix(recall.recall_initiation_date).format('MMMM Do, YYYY') %>
						</small>
					</h4>
					<p class="recall-reason"><%= recall.reason_for_recall %></p>
					<ul class="list-inline">
						<li>
							<div class="dropup">
								<span data-toggle="dropdown" rel="tooltip" data-placement="bottom" title="Share recall with others" class="btn btn-link dropdown-toggle"><i class="glyphicon glyphicon-share-alt"></i> Share</span>
								<ul class="dropdown-menu dropdown-menu-right" role="menu">
									<li role="presentation">
										<a href="#" data-action="recall-copy" data-text="" role="menuitem" tabindex="-1">
											<i class="glyphicon glyphicon-link"></i> Copy
										</a>
									</li>
									<li role="presentation">
										<a href="" role="menuitem" tabindex="-1" target="_blank">
											<i class="glyphicon glyphicon-envelope"></i> E-mail
										</a>
									</li>
									<li role="presentation">
										<a href="#" data-href="" onclick="window.open(this.dataset.href, 'FeedDialog', 'width=500,height=300,resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no'); return false;" role="menuitem" tabindex="-1">
											<i class="fa fa-facebook-official"></i> Facebook
										</a>
									</li>
								</ul>
							</div>
						</li>
					</ul>
				</li>
			</ol>
			<h4 class="recall-number"><label><%= recall.recall_number %></label></h4>
			<ul class="details">
				<!-- <li><p class="event-id"><label style="padding-right: 4px;">Event Id:</label><%= recall.event_id %></p></li> -->
				<li><p class="company-location"><label style="padding-right: 4px;">Company Location:</label><%= recall.city %>, <%= recall.state %> <%= recall.country %></p></li>
				<li><p class="status"><label style="padding-right: 4px;">Current Status:</label><%= recall.status %></p></li>
				<li><p class="product-quantity"><label style="padding-right: 4px;">Number of Products Affect:</label><%= recall.product_quantity %></p></li>
				<li><p class="report-date"><label style="padding-right: 4px;">Report Date:</label><%= moment.unix(recall.report_date).format('MMMM Do, YYYY') %></p></li>
				<li><p class="voluntary-mandated"><label style="padding-right: 4px;">Voluntary or Mandated:</label><%= recall.voluntary_mandated %></p></li>
				<li><p class="initial-firm-notification"><label style="padding-right: 4px;">Initial Firm Notification:</label><%= recall.initial_firm_notification %></p></li>
			</ul>
		</div>
	</div>
	<div class="text-center visible-xs hidden-sm hidden-md hidden-lg">
		<button data-action="load-comments" type="button" class="btn btn-link">
			<i class="glyphicon glyphicon-eye-open"></i> Show comments
		</button>
	</div>
	<div class="comment-log-container hidden-xs visible-sm visible-md visible-lg">
		<header class="panel-heading">
			<h3 style="margin-bottom: 20px; margin-top: 13px;">Recall comments</h3>
		</header>
		<div class="panel-body">
			<form>
				<input type="hidden" name="recallnumber" value="<%= recall.recall_number %>"/>
				<input type="hidden" name="location" value="<%= session.preferences.state %>"/>

				<div class="form-group">
					<label for="name">Name</label>
					<input type="text" class="form-control" name="name" placeholder="Name" required>
				</div>
				<div class="form-group">
					<label for="comment">Comment</label>
					<textarea class="form-control" rows="3" name="comment" placeholder="Leave a comment" required></textarea>
				</div>
				<button type="submit" class="btn btn-default">Submit</button>
			</form>
			<ol id="recall-comments" class="list-view<%= recall.comments.length === 0 ? ' empty' : '' %>">
				<!-- recall cards placeholder -->
				<% _.each(recall.comments, function (comment) { %>
				<%
					comment.name = comment.name || 'User';
					comment.location = comment.location || 'Unknown';
					comment.created = moment.unix(comment.created).format('MMMM Do, YYYY hh:mma');
				%>
				<li class="comment-entry">
					<%= comment.name %> from <%= comment.location %>
					<small class="event-subtitle text-muted" title="<%= comment.created %>"><%= comment.created %></small>
					<p class="comment-body"><%= comment.comment %></p>
				</li>
				<% }); %>
			</ol>
			<div class="list-view-messages">
				<!-- <p class="list-view-loading-message spinner spinner-pulsation spinner-primary">Loading...</p> -->

				<% if (recall.comments.length == 0) { %>
				<p class="list-view-empty-message">There are no recall comments.</p>
				<% } %>

				<!-- <p class="list-view-error-message">Oops, we had trouble retrieving recent recall comments!</p> -->
			</div>
			<div class="text-center">
				<button type="button" class="btn btn-success hidden" data-action="load-more-comments"><i
							class="glyphicon glyphicon-chevron-down"></i> Load more
				</button>
			</div>
		</div>
	</div>
</div>
<script data-main="/js/app-recall" src="/js/require.js"></script>
<script>
	brie.page.recall = <%- JSON.stringify(recall) %>;
</script>
<% } else { %>
</head>
<body class="bg-void">
<div>
	Error encountered. <%= error.statusCode %> - <%= error.message %>
</div>
<% } %>
</body>
</html>